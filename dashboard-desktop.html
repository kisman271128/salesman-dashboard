<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Modern Sales Dashboard - Salesman App</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Modern color palette */
            --primary: #4361ee;
            --primary-dark: #3a56e0;
            --secondary: #7209b7;
            --accent: #4cc9f0;
            --success: #2ec4b6;
            --warning: #ff9f1c;
            --danger: #e71d36;
            --dark: #1a1a2e;
            --dark-alt: #16213e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border: rgba(255, 255, 255, 0.08);
            
            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            
            /* Transitions */
            --transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .desktop-container {
            display: flex;
            min-height: 100vh;
        }

        /* ✅ MODERN SIDEBAR */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--dark), var(--dark-alt));
            padding: 0;
            box-shadow: var(--shadow-lg);
            position: fixed;
            height: 100vh;
            z-index: 1000;
            overflow-y: auto;
            border-right: 1px solid var(--border);
        }

        .sidebar-header {
            padding: 28px 24px;
            text-align: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 16px;
        }

        .company-logo {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: 1px;
            background: linear-gradient(135deg, #fff, #d1d5db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .company-subtitle {
            font-size: 13px;
            opacity: 0.85;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        .sidebar-nav {
            padding: 0 16px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .nav-item:hover {
            background: rgba(67, 97, 238, 0.15);
            color: white;
            transform: translateX(4px);
        }

        .nav-item.active {
            background: rgba(67, 97, 238, 0.25);
            color: white;
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.3);
        }

        .nav-icon {
            font-size: 20px;
            margin-right: 16px;
            width: 24px;
            text-align: center;
        }

        .nav-label {
            font-size: 15px;
            font-weight: 500;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 24px;
            border-top: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .user-details h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-details p {
            font-size: 13px;
            opacity: 0.8;
            font-weight: 400;
        }

        /* ✅ MAIN CONTENT AREA */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .top-header {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            box-shadow: var(--shadow-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 6px;
            background: linear-gradient(90deg, #fff, #cbd5e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-left p {
            font-size: 14px;
            color: #94a3b8;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* ✅ MODERN REFRESH BUTTON */
        .refresh-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
            background: linear-gradient(135deg, var(--primary-dark), #6a0dad);
        }

        /* ✅ DASHBOARD CONTENT */
        .dashboard-content {
            flex: 1;
            padding: 30px 40px;
            overflow-y: auto;
        }

        /* ✅ MODERN METRICS CARDS */
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            background: rgba(67, 97, 238, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .metric-title {
            font-size: 14px;
            color: #94a3b8;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #fff, #cbd5e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .metric-change {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(46, 196, 182, 0.1);
            width: fit-content;
        }

        .metric-change.positive {
            color: var(--success);
        }

        .metric-change.negative {
            background: rgba(231, 29, 54, 0.1);
            color: var(--danger);
        }

        /* ✅ MODERN DASHBOARD GRID */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            height: calc(100vh - 200px);
        }

        /* ✅ MODERN LOB CARDS SECTION */
        .lob-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .lob-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            max-height: 340px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .lob-card {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 16px;
            padding: 20px;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .lob-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--card-color, linear-gradient(90deg, var(--primary), var(--secondary)));
        }

        .lob-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(67, 97, 238, 0.3);
        }

        /* ✅ LOB CARD COLORS */
        .lob-card.color-0 { --card-color: linear-gradient(90deg, #ff6b6b, #ee5a24); }
        .lob-card.color-1 { --card-color: linear-gradient(90deg, #4ecdc4, #44a08d); }
        .lob-card.color-2 { --card-color: linear-gradient(90deg, #45b7d1, #96c93d); }
        .lob-card.color-3 { --card-color: linear-gradient(90deg, #f9ca24, #f0932b); }
        .lob-card.color-4 { --card-color: linear-gradient(90deg, #eb4d4b, #6c5ce7); }
        .lob-card.color-5 { --card-color: linear-gradient(90deg, #a55eea, #26de81); }
        .lob-card.color-6 { --card-color: linear-gradient(90deg, #fd79a8, #fdcb6e); }
        .lob-card.color-7 { --card-color: linear-gradient(90deg, #e17055, #81ecec); }
        .lob-card.color-8 { --card-color: linear-gradient(90deg, #00b894, #00cec9); }

        .lob-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .lob-name {
            font-size: 16px;
            font-weight: 700;
            color: #f8fafc;
        }

        .achievement-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);
        }

        .lob-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .lob-metric {
            text-align: center;
            padding: 12px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .lob-metric-label {
            font-size: 12px;
            color: #94a3b8;
            font-weight: 500;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .lob-metric-value {
            font-size: 14px;
            font-weight: 700;
            color: #f8fafc;
        }

        .lob-vs-metrics {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .lob-vs-metric {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .lob-vs-label {
            font-size: 11px;
            color: #94a3b8;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .lob-vs-value {
            font-size: 13px;
            font-weight: 700;
            color: #f8fafc;
        }

        /* ✅ MODERN CHART SECTION */
        .chart-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 30px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chart-period {
            background: rgba(15, 23, 42, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #cbd5e1;
        }

        .chart-container {
            height: 240px;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .legend-color {
            width: 16px;
            height: 4px;
            border-radius: 2px;
        }

        .chart-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .chart-stat {
            text-align: center;
            padding: 16px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .chart-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 6px;
        }

        .chart-stat-label {
            font-size: 12px;
            color: #94a3b8;
            font-weight: 500;
            text-transform: uppercase;
        }

        /* ✅ MODERN SALESMAN SECTION */
        .salesman-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .salesman-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .salesman-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .salesman-count {
            background: rgba(15, 23, 42, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #cbd5e1;
        }

        .salesman-table-container {
            flex: 1;
            overflow-y: auto;
            max-height: calc(100vh - 380px);
        }

        .salesman-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }

        .salesman-table th {
            background: rgba(15, 23, 42, 0.4);
            color: #94a3b8;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .salesman-table td {
            padding: 16px 12px;
            font-size: 14px;
            vertical-align: middle;
            background: rgba(15, 23, 42, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .salesman-table tr td:first-child {
            border-left: 1px solid rgba(255, 255, 255, 0.05);
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }

        .salesman-table tr td:last-child {
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }

        .salesman-table tr:hover td {
            background: rgba(67, 97, 238, 0.1);
        }

        .rank-column {
            text-align: center;
            font-weight: 700;
            color: var(--accent);
            width: 60px;
        }

        .salesman-name-cell {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .salesman-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .salesman-info h4 {
            font-size: 15px;
            font-weight: 600;
            color: #f8fafc;
            margin-bottom: 4px;
        }

        .salesman-info p {
            font-size: 13px;
            color: #94a3b8;
        }

        .achievement-cell {
            text-align: center;
        }

        .achievement-value {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);
        }

        .status-cell {
            text-align: center;
        }

        .status-badge {
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
            min-width: 110px;
        }

        .status-excellent {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .status-very-good {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        .status-good {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .status-extra-effort {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .action-cell {
            text-align: center;
        }

        .view-btn {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
            border: 1px solid rgba(67, 97, 238, 0.3);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .view-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ✅ LOADING AND ERROR STATES */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            flex-direction: column;
            gap: 24px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            font-size: 16px;
            font-weight: 600;
            color: #94a3b8;
        }

        .error-message {
            background: rgba(231, 29, 54, 0.15);
            border: 1px solid rgba(231, 29, 54, 0.3);
            color: #e71d36;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            max-width: 600px;
            margin: 40px auto;
        }

        .error-message h3 {
            font-size: 24px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .error-message p {
            font-size: 16px;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        /* ✅ SCROLLBAR STYLING */
        .lob-grid::-webkit-scrollbar,
        .salesman-table-container::-webkit-scrollbar {
            width: 8px;
        }

        .lob-grid::-webkit-scrollbar-track,
        .salesman-table-container::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.3);
            border-radius: 4px;
        }

        .lob-grid::-webkit-scrollbar-thumb,
        .salesman-table-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .lob-grid::-webkit-scrollbar-thumb:hover,
        .salesman-table-container::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* ✅ ANIMATIONS */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* ✅ RESPONSIVE */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .salesman-table-container {
                max-height: 400px;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
            }
            
            .main-content {
                margin-left: 80px;
            }
            
            .company-logo, .company-subtitle, .nav-label, .user-details {
                display: none;
            }
            
            .sidebar-header {
                padding: 24px 0;
            }
            
            .nav-item {
                justify-content: center;
                padding: 20px 0;
            }
            
            .nav-icon {
                margin-right: 0;
                font-size: 24px;
            }
            
            .sidebar-footer {
                padding: 20px 0;
                justify-content: center;
            }
            
            .user-info {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .metrics-row {
                grid-template-columns: 1fr;
            }
            
            .top-header {
                padding: 16px 24px;
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .header-right {
                width: 100%;
                justify-content: flex-end;
            }
            
            .lob-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
<div class="desktop-container">
<!-- ✅ MODERN SIDEBAR -->
<div class="sidebar">
<div class="sidebar-header">
<div class="company-logo">SALES DASH</div>
<div class="company-subtitle">Performance Dashboard</div>
</div>
<nav class="sidebar-nav">
<div class="nav-item active" onclick="showDashboard()">
<div class="nav-icon">📊</div>
<div class="nav-label">Dashboard</div>
</div>
<div class="nav-item" onclick="showActivity()">
<div class="nav-icon">🚀</div>
<div class="nav-label">Activity</div>
</div>
<div class="nav-item" onclick="showInsentif()">
<div class="nav-icon">💰</div>
<div class="nav-label">Incentives</div>
</div>
<div class="nav-item" onclick="showReports()">
<div class="nav-icon">📈</div>
<div class="nav-label">Reports</div>
</div>
<div class="nav-item" onclick="showSettings()">
<div class="nav-icon">⚙️</div>
<div class="nav-label">Settings</div>
</div>
<div class="nav-item" onclick="logout()">
<div class="nav-icon">🔒</div>
<div class="nav-label">Logout</div>
</div>
</nav>
<div class="sidebar-footer">
<div class="user-info">
<div class="user-avatar" id="userAvatar">A</div>
<div class="user-details">
<h4 id="userName">Admin User</h4>
<p id="userRole">Administrator</p>
</div>
</div>
</div>
</div>

<!-- ✅ MAIN CONTENT -->
<div class="main-content">
<!-- ✅ TOP HEADER -->
<div class="top-header">
<div class="header-left">
<h1 id="depoName">Sales Dashboard</h1>
<p id="regionName">Loading region information...</p>
</div>
<div class="header-right">
<button class="refresh-btn" onclick="loadDashboardData()">
    🔄 Refresh Data
</button>
</div>
</div>

<!-- ✅ DASHBOARD CONTENT -->
<div class="dashboard-content">
<!-- Loading State -->
<div class="loading-spinner" id="loadingSpinner">
<div class="spinner"></div>
<div class="loading-text">Loading dashboard data...</div>
</div>

<!-- Error State -->
<div class="error-message" id="errorMessage" style="display: none;">
<h3>📡 Connection Error</h3>
<p>We couldn't load the dashboard data. Please check your internet connection and try again.</p>
<button class="refresh-btn" onclick="loadDashboardData()">Retry</button>
</div>

<!-- Main Dashboard Content -->
<div id="dashboardContent" style="display: none;">
<!-- ✅ METRICS ROW -->
<div class="metrics-row" id="metricsRow">
<!-- Will be populated by JavaScript -->
</div>

<!-- ✅ DASHBOARD GRID -->
<div class="dashboard-grid">
<!-- ✅ LEFT COLUMN -->
<div>
<!-- ✅ LOB SECTION -->
<div class="lob-section">
<div class="section-header">
<h3 class="section-title">
    <span>📊</span>
    Line of Business Performance
</h3>
</div>
<div class="lob-grid" id="lobGrid">
<!-- Will be populated by JavaScript -->
</div>
</div>

<!-- ✅ CHART SECTION -->
<div class="chart-section">
<div class="chart-header">
<h3 class="chart-title">📈 Sales Order & Delivery Trends</h3>
<div class="chart-period" id="chartPeriod">Current Period</div>
</div>
<div class="chart-legend">
<div class="legend-item">
<div class="legend-color" style="background: linear-gradient(90deg, #667eea, #764ba2);"></div>
<span>Sales Orders</span>
</div>
<div class="legend-item">
<div class="legend-color" style="background: linear-gradient(90deg, #f093fb, #f5576c);"></div>
<span>Deliveries</span>
</div>
<div class="legend-item">
<div class="legend-color" style="background: linear-gradient(90deg, #43e97b, #38f9d7);"></div>
<span>Target</span>
</div>
</div>
<div class="chart-container">
<canvas id="chartCanvas" style="width: 100%; height: 100%;"></canvas>
</div>
<div class="chart-stats" id="chartStats">
<!-- Will be populated by JavaScript -->
</div>
</div>
</div>

<!-- ✅ RIGHT COLUMN - SALESMAN SECTION -->
<div class="salesman-section">
<div class="salesman-header">
<h3 class="salesman-title">👥 Top Sales Team</h3>
<div class="salesman-count" id="salesmanCount">12 Salespeople</div>
</div>
<div class="salesman-table-container">
<table class="salesman-table">
<thead>
<tr>
<th>Rank</th>
<th>Salesperson</th>
<th>Achievement</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody id="salesmanTableBody">
<!-- Rows will be populated by JavaScript -->
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<script>
    // Global variables
    let dashboardData = null;
    let salesmanData = null;
    let chartData = null;
    let chartInstance = null;

    // ✅ FORMAT CURRENCY FUNCTION
    function formatCurrencyIndonesia(value) {
        try {
            const val = parseFloat(value);
            
            if (val >= 1000000000) {
                return 'Rp' + (val / 1000000000).toFixed(1) + 'M';
            } else if (val >= 1000000) {
                return 'Rp' + (val / 1000000).toFixed(1) + 'Jt';
            } else if (val >= 1000) {
                return 'Rp' + Math.round(val / 1000) + 'Rb';
            } else {
                return 'Rp' + Math.round(val).toString();
            }
        } catch {
            return "Rp0";
        }
    }

    // Check login status
    function checkLoginStatus() {
        const isLoggedIn = sessionStorage.getItem('isLoggedIn');
        if (!isLoggedIn) {
            window.location.href = 'index.html';
            return false;
        }
        
        const currentUser = sessionStorage.getItem('currentUser') || 'Admin';
        document.getElementById('userName').textContent = currentUser;
        document.getElementById('userAvatar').textContent = currentUser.charAt(0).toUpperCase();
        
        return true;
    }

    // ✅ LOAD DASHBOARD DATA
    async function loadDashboardData() {
        try {
            showLoading(true);
            hideError();

            console.log('🔄 Loading dashboard data...');
            
            // Simulated API delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Mock data since we don't have actual API endpoints
            dashboardData = {
                depo_name: "Jakarta Central Depot",
                region_name: "West Java Region",
                lob_cards: [
                    {
                        name: "Consumer Electronics",
                        achievement: "98%",
                        actual: "Rp1.2M",
                        target: "Rp1.2M",
                        gap: "Rp0",
                        vs_lm: "+12%",
                        vs_3lm: "+8%",
                        vs_ly: "+22%"
                    },
                    {
                        name: "Home Appliances",
                        achievement: "87%",
                        actual: "Rp980Rb",
                        target: "Rp1.1M",
                        gap: "Rp120Rb",
                        vs_lm: "+5%",
                        vs_3lm: "+3%",
                        vs_ly: "+15%"
                    },
                    {
                        name: "Mobile Devices",
                        achievement: "105%",
                        actual: "Rp1.5M",
                        target: "Rp1.4M",
                        gap: "Rp100Rb",
                        vs_lm: "+18%",
                        vs_3lm: "+12%",
                        vs_ly: "+30%"
                    },
                    {
                        name: "Computing",
                        achievement: "92%",
                        actual: "Rp850Rb",
                        target: "Rp920Rb",
                        gap: "Rp70Rb",
                        vs_lm: "+7%",
                        vs_3lm: "+4%",
                        vs_ly: "+18%"
                    },
                    {
                        name: "Gaming",
                        achievement: "110%",
                        actual: "Rp650Rb",
                        target: "Rp590Rb",
                        gap: "Rp60Rb",
                        vs_lm: "+25%",
                        vs_3lm: "+18%",
                        vs_ly: "+42%"
                    },
                    {
                        name: "Audio Equipment",
                        achievement: "83%",
                        actual: "Rp420Rb",
                        target: "Rp510Rb",
                        gap: "Rp90Rb",
                        vs_lm: "+3%",
                        vs_3lm: "-2%",
                        vs_ly: "+10%"
                    }
                ]
            };

            salesmanData = [
                {id: "SM001", name: "Budi Santoso", type: "Senior Sales", rank: 1, achievement: "128%", status: "Excellent"},
                {id: "SM002", name: "Siti Rahayu", type: "Field Sales", rank: 2, achievement: "118%", status: "Excellent"},
                {id: "SM003", name: "Ahmad Fauzi", type: "Account Manager", rank: 3, achievement: "112%", status: "Very Good"},
                {id: "SM004", name: "Dewi Lestari", type: "Retail Sales", rank: 4, achievement: "108%", status: "Very Good"},
                {id: "SM005", name: "Rudi Hermawan", type: "Field Sales", rank: 5, achievement: "102%", status: "Very Good"},
                {id: "SM006", name: "Linda Suryani", type: "Senior Sales", rank: 6, achievement: "98%", status: "Good"},
                {id: "SM007", name: "Eko Prasetyo", type: "Retail Sales", rank: 7, achievement: "94%", status: "Good"},
                {id: "SM008", name: "Maya Indah", type: "Account Manager", rank: 8, achievement: "89%", status: "Good"},
                {id: "SM009", name: "Joko Susilo", type: "Field Sales", rank: 9, achievement: "85%", status: "Extra Effort"},
                {id: "SM010", name: "Rina Wijaya", type: "Retail Sales", rank: 10, achievement: "82%", status: "Extra Effort"}
            ];

            chartData = {
                period: "Jan 1 - Dec 31, 2023",
                labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                so_data: [120, 135, 148, 165, 180, 210, 230, 250, 265, 280, 300, 320],
                do_data: [110, 125, 140, 155, 170, 195, 215, 235, 250, 265, 285, 305],
                target_data: [130, 140, 150, 160, 170, 185, 200, 215, 230, 245, 260, 280],
                stats: {
                    avg_so: 225,
                    avg_do: 210,
                    avg_target: 205,
                    gap_total: "15%"
                }
            };

            console.log('✅ Dashboard data loaded');

            updateHeader(dashboardData);
            updateMetricsRow(dashboardData);
            updateLOBCards(dashboardData.lob_cards);
            updateSalesmanTable(salesmanData);
            updateChart(chartData);

            showLoading(false);
            showMainContent(true);

        } catch (error) {
            console.error('❌ Error loading dashboard data:', error);
            showLoading(false);
            showError(true);
        }
    }

    // ✅ UPDATE HEADER
    function updateHeader(data) {
        document.getElementById('depoName').textContent = data.depo_name || 'Dashboard';
        document.getElementById('regionName').textContent = data.region_name || 'Region information';
    }

    // ✅ UPDATE METRICS ROW
    function updateMetricsRow(data) {
        const metricsRow = document.getElementById('metricsRow');
        
        // Calculate summary metrics
        const totalLOB = data.lob_cards.length;
        const avgAchievement = data.lob_cards.reduce((sum, lob) => 
            sum + parseInt(lob.achievement.replace('%', '')), 0) / totalLOB;
        
        const totalActual = data.lob_cards.reduce((sum, lob) => {
            const actualValue = parseFloat(lob.actual.replace(/[^\d.-]/g, ''));
            return sum + actualValue;
        }, 0);
        
        const totalTarget = data.lob_cards.reduce((sum, lob) => {
            const targetValue = parseFloat(lob.target.replace(/[^\d.-]/g, ''));
            return sum + targetValue;
        }, 0);

        metricsRow.innerHTML = `
            <div class="metric-card fade-in">
                <div class="metric-header">
                    <div>
                        <div class="metric-title">Total LOB</div>
                        <div class="metric-value">${totalLOB}</div>
                    </div>
                    <div class="metric-icon">📊</div>
                </div>
                <div class="metric-change positive">
                    ↗ ${totalLOB > 5 ? 'Strong' : 'Standard'} Coverage
                </div>
            </div>
            <div class="metric-card fade-in" style="animation-delay: 0.1s;">
                <div class="metric-header">
                    <div>
                        <div class="metric-title">Avg. Achievement</div>
                        <div class="metric-value">${Math.round(avgAchievement)}%</div>
                    </div>
                    <div class="metric-icon">🎯</div>
                </div>
                <div class="metric-change ${avgAchievement >= 90 ? 'positive' : 'negative'}">
                    ${avgAchievement >= 90 ? '↗ Exceeding' : '↘ Below'} Target
                </div>
            </div>
            <div class="metric-card fade-in" style="animation-delay: 0.2s;">
                <div class="metric-header">
                    <div>
                        <div class="metric-title">Total Actual</div>
                        <div class="metric-value">${formatCurrencyIndonesia(totalActual)}</div>
                    </div>
                    <div class="metric-icon">💰</div>
                </div>
                <div class="metric-change positive">
                    ↗ ${totalActual > totalTarget ? 'Above' : 'Below'} Target
                </div>
            </div>
            <div class="metric-card fade-in" style="animation-delay: 0.3s;">
                <div class="metric-header">
                    <div>
                        <div class="metric-title">Total Target</div>
                        <div class="metric-value">${formatCurrencyIndonesia(totalTarget)}</div>
                    </div>
                    <div class="metric-icon">📈</div>
                </div>
                <div class="metric-change">
                    Monthly Target
                </div>
            </div>
        `;
    }

    // ✅ UPDATE LOB CARDS
    function updateLOBCards(lobCards) {
        const lobGrid = document.getElementById('lobGrid');
        lobGrid.innerHTML = '';

        lobCards.forEach((lob, index) => {
            const card = createLOBCard(lob, index);
            lobGrid.appendChild(card);
        });

        console.log('✅ Generated', lobCards.length, 'LOB cards');
    }

    // ✅ CREATE LOB CARD
    function createLOBCard(lob, index) {
        const card = document.createElement('div');
        card.className = `lob-card color-${index % 6} fade-in`;
        card.style.animationDelay = `${index * 0.05}s`;
        
        card.innerHTML = `
            <div class="lob-header">
                <div class="lob-name">${lob.name}</div>
                <div class="achievement-badge">${lob.achievement}</div>
            </div>
            
            <div class="lob-metrics">
                <div class="lob-metric">
                    <div class="lob-metric-label">Actual</div>
                    <div class="lob-metric-value">${lob.actual}</div>
                </div>
                <div class="lob-metric">
                    <div class="lob-metric-label">Target</div>
                    <div class="lob-metric-value">${lob.target}</div>
                </div>
                <div class="lob-metric">
                    <div class="lob-metric-label">Gap</div>
                    <div class="lob-metric-value">${lob.gap}</div>
                </div>
            </div>
            
            <div class="lob-vs-metrics">
                <div class="lob-vs-metric">
                    <div class="lob-vs-label">vs Last Month</div>
                    <div class="lob-vs-value">${lob.vs_lm || '0%'}</div>
                </div>
                <div class="lob-vs-metric">
                    <div class="lob-vs-label">vs 3-Month Avg</div>
                    <div class="lob-vs-value">${lob.vs_3lm || '0%'}</div>
                </div>
                <div class="lob-vs-metric">
                    <div class="lob-vs-label">vs Last Year</div>
                    <div class="lob-vs-value">${lob.vs_ly || '0%'}</div>
                </div>
            </div>
        `;

        card.addEventListener('click', () => {
            console.log(`Clicked on LOB ${lob.name}`);
        });

        return card;
    }

    // ✅ UPDATE CHART
    function updateChart(chartData) {
        console.log('🎨 Updating chart with data:', chartData);
        
        if (!chartData || !chartData.so_data || !chartData.do_data) {
            console.warn('No chart data available');
            return;
        }

        const chartPeriodElement = document.getElementById('chartPeriod');
        if (chartPeriodElement && chartData.period) {
            chartPeriodElement.textContent = chartData.period;
        }

        // Create or update the chart
        const ctx = document.getElementById('chartCanvas').getContext('2d');
        
        // Destroy previous chart instance if exists
        if (chartInstance) {
            chartInstance.destroy();
        }
        
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartData.labels,
                datasets: [
                    {
                        label: 'Sales Orders',
                        data: chartData.so_data,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: false
                    },
                    {
                        label: 'Deliveries',
                        data: chartData.do_data,
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: false
                    },
                    {
                        label: 'Target',
                        data: chartData.target_data,
                        borderColor: '#43e97b',
                        backgroundColor: 'rgba(67, 233, 123, 0.1)',
                        borderWidth: 3,
                        borderDash: [5, 5],
                        tension: 0.3,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(30, 41, 59, 0.9)',
                        titleColor: '#f8fafc',
                        bodyColor: '#e2e8f0',
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#94a3b8'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#94a3b8'
                        }
                    }
                }
            }
        });

        updateChartStats(chartData.stats);
    }

    // ✅ UPDATE CHART STATS
    function updateChartStats(stats) {
        const chartStatsElement = document.getElementById('chartStats');
        if (!chartStatsElement) return;
        
        let avgSO = stats.avg_so;
        let avgDO = stats.avg_do;
        let avgTarget = stats.avg_target;
        let gapTotal = stats.gap_total;
        
        if (typeof avgSO === 'number') {
            avgSO = formatCurrencyIndonesia(avgSO);
        }
        if (typeof avgDO === 'number') {
            avgDO = formatCurrencyIndonesia(avgDO);
        }
        if (typeof avgTarget === 'number') {
            avgTarget = formatCurrencyIndonesia(avgTarget);
        }
        
        chartStatsElement.innerHTML = `
            <div class="chart-stat">
                <div class="chart-stat-value">${avgSO}</div>
                <div class="chart-stat-label">Avg SO/Day</div>
            </div>
            <div class="chart-stat">
                <div class="chart-stat-value">${avgDO}</div>
                <div class="chart-stat-label">Avg DO/Day</div>
            </div>
            <div class="chart-stat">
                <div class="chart-stat-value">${avgTarget}</div>
                <div class="chart-stat-label">Target/Day</div>
            </div>
            <div class="chart-stat">
                <div class="chart-stat-value">${gapTotal || '0'}</div>
                <div class="chart-stat-label">Total Gap</div>
            </div>
        `;
        
        console.log('✅ Chart stats updated');
    }

    // ✅ UPDATE SALESMAN TABLE
    function updateSalesmanTable(salesmanList) {
        const tableBody = document.getElementById('salesmanTableBody');
        const salesmanCount = document.getElementById('salesmanCount');
        
        tableBody.innerHTML = '';
        salesmanCount.textContent = `${salesmanList.length} Salespeople`;

        salesmanList.forEach((salesman, index) => {
            const row = createSalesmanRow(salesman, index);
            tableBody.appendChild(row);
        });

        console.log('✅ Salesman table updated');
    }

    // ✅ CREATE SALESMAN ROW
    function createSalesmanRow(salesman, index) {
        const row = document.createElement('tr');
        row.style.animationDelay = `${index * 0.02}s`;
        row.className = 'fade-in';
        
        const statusClass = getStatusClass(salesman.status);
        
        row.innerHTML = `
            <td class="rank-column">${salesman.rank}</td>
            <td>
                <div class="salesman-name-cell">
                    <div class="salesman-avatar" data-nik="${salesman.id}">
                        ${salesman.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="salesman-info">
                        <h4>${salesman.name}</h4>
                        <p>${salesman.type}</p>
                    </div>
                </div>
            </td>
            <td class="achievement-cell">
                <div class="achievement-value">${salesman.achievement}</div>
            </td>
            <td class="status-cell">
                <div class="status-badge ${statusClass}">${salesman.status}</div>
            </td>
            <td class="action-cell">
                <button class="view-btn" onclick="openSalesmanDetail('${salesman.id}')">
                    View
                </button>
            </td>
        `;

        return row;
    }

    function getStatusClass(status) {
        switch (status) {
            case 'Extra Effort': return 'status-extra-effort';
            case 'Good': return 'status-good';
            case 'Very Good': return 'status-very-good';
            case 'Excellent': return 'status-excellent';
            default: return 'status-good';
        }
    }

    // ✅ NAVIGATION FUNCTIONS
    function openSalesmanDetail(salesmanId) {
        console.log(`🚀 Navigating to salesman detail: ${salesmanId}`);
        alert(`Opening details for salesman: ${salesmanId}`);
    }

    function showDashboard() {
        console.log('Already on dashboard');
    }

    function showActivity() {
        alert('🔜 Activity module coming soon!');
    }

    function showInsentif() {
        alert('🔜 Incentives module coming soon!');
    }

    function showReports() {
        alert('🔜 Reports module coming soon!');
    }

    function showSettings() {
        alert('🔜 Settings module coming soon!');
    }

    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            sessionStorage.removeItem('isLoggedIn');
            sessionStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    }

    // ✅ UI CONTROL FUNCTIONS
    function showLoading(show) {
        document.getElementById('loadingSpinner').style.display = show ? 'flex' : 'none';
    }

    function showError(show) {
        document.getElementById('errorMessage').style.display = show ? 'block' : 'none';
    }

    function hideError() {
        showError(false);
    }

    function showMainContent(show) {
        document.getElementById('dashboardContent').style.display = show ? 'block' : 'none';
    }

    // ✅ INITIALIZE DASHBOARD
    document.addEventListener('DOMContentLoaded', function() {
        if (!checkLoginStatus()) {
            return;
        }

        console.log('🚀 Initializing dashboard...');
        loadDashboardData();
        console.log('✅ Dashboard initialized');
    });

    // Handle window resize for chart
    window.addEventListener('resize', () => {
        if (chartData) {
            setTimeout(() => {
                updateChart(chartData);
            }, 300);
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>