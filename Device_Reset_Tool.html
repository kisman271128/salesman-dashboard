<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Registration Reset Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 24px;
        }
        .subtitle {
            color: #64748b;
            margin-bottom: 24px;
            font-size: 14px;
        }
        .user-info {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
        }
        .user-info h3 {
            color: #3b82f6;
            font-size: 14px;
            margin-bottom: 12px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .info-label {
            color: #64748b;
            font-size: 13px;
        }
        .info-value {
            color: #1e293b;
            font-weight: 600;
            font-size: 13px;
        }
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        .status-box {
            padding: 16px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
            line-height: 1.6;
            display: none;
        }
        .status-box.show {
            display: block;
        }
        .status-info {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            color: #1e40af;
        }
        .status-success {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
        }
        .status-error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 16px;
            overflow-x: auto;
            white-space: pre;
        }
        .steps {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 16px;
            margin-top: 20px;
        }
        .steps h4 {
            color: #78350f;
            margin-bottom: 12px;
            font-size: 14px;
        }
        .steps ol {
            color: #92400e;
            font-size: 13px;
            line-height: 1.8;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Device Reset Tool</h1>
        <p class="subtitle">Tool untuk reset device registration user yang tidak bisa login</p>

        <div class="user-info">
            <h3>üë§ User Information</h3>
            <div class="info-row">
                <span class="info-label">NIK</span>
                <span class="info-value">17210041060</span>
            </div>
            <div class="info-row">
                <span class="info-label">Nama</span>
                <span class="info-value">Bahrudin Rahman</span>
            </div>
            <div class="info-row">
                <span class="info-label">Password</span>
                <span class="info-value">tanjung2025</span>
            </div>
            <div class="info-row">
                <span class="info-label">Role</span>
                <span class="info-value">Salesman</span>
            </div>
        </div>

        <button class="btn btn-primary" onclick="checkDeviceData()">
            üîç Check Device Registration
        </button>

        <button class="btn btn-danger" onclick="clearDeviceData()">
            üóëÔ∏è Clear Device Data (Fix Login)
        </button>

        <button class="btn btn-success" onclick="openLoginPage()">
            üîê Open Login Page
        </button>

        <div id="statusBox" class="status-box"></div>

        <div class="steps">
            <h4>üìã Cara Menggunakan:</h4>
            <ol>
                <li>Klik "Check Device Registration" untuk lihat status</li>
                <li>Klik "Clear Device Data" untuk reset device</li>
                <li>Klik "Open Login Page" untuk coba login</li>
                <li>Login dengan NIK: 17210041060, Password: tanjung2025</li>
            </ol>
        </div>
    </div>

    <script>
        function showStatus(message, type) {
            const box = document.getElementById('statusBox');
            box.className = 'status-box show status-' + type;
            box.innerHTML = message;
        }

        function checkDeviceData() {
            let report = '<strong>üìä Device Data Status:</strong><br><br>';
            let foundData = false;

            // Check all device-related keys
            const deviceKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.toLowerCase().includes('device')) {
                    deviceKeys.push(key);
                    foundData = true;
                }
            }

            if (foundData) {
                report += '‚ùå <strong>Device data ditemukan</strong> (ini yang menyebabkan login gagal):<br><br>';
                deviceKeys.forEach(key => {
                    const data = localStorage.getItem(key);
                    report += `‚Ä¢ <code>${key}</code>: ${data ? data.substring(0, 50) + '...' : 'null'}<br>`;
                });
                report += '<br>üí° Klik "Clear Device Data" untuk menghapus dan fix login.';
                showStatus(report, 'error');
            } else {
                report += '‚úÖ <strong>Tidak ada device data</strong><br><br>';
                report += 'Device registration sudah clear. Silakan coba login.';
                showStatus(report, 'success');
            }

            // Check for user 17210041060 specifically
            try {
                const deviceRegs = JSON.parse(localStorage.getItem('deviceRegistrations') || '{}');
                if (deviceRegs['17210041060']) {
                    report += '<br><br>‚ö†Ô∏è <strong>User 17210041060 memiliki device registration!</strong><br>';
                    report += `Device: ${JSON.stringify(deviceRegs['17210041060']).substring(0, 100)}...`;
                    showStatus(report, 'error');
                }
            } catch (e) {
                console.error('Error checking device registrations:', e);
            }
        }

        function clearDeviceData() {
            if (!confirm('‚ö†Ô∏è Clear device data untuk user 17210041060?\n\nIni akan menghapus semua device registration dan memungkinkan user untuk login lagi.')) {
                return;
            }

            let cleared = 0;
            const keysToRemove = [];

            // Find all device-related keys
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.toLowerCase().includes('device')) {
                    keysToRemove.push(key);
                }
            }

            // Remove them
            keysToRemove.forEach(key => {
                console.log('Removing:', key);
                localStorage.removeItem(key);
                cleared++;
            });

            // Also clear specific user device
            try {
                const deviceRegs = JSON.parse(localStorage.getItem('deviceRegistrations') || '{}');
                if (deviceRegs['17210041060']) {
                    delete deviceRegs['17210041060'];
                    localStorage.setItem('deviceRegistrations', JSON.stringify(deviceRegs));
                    cleared++;
                }
            } catch (e) {
                console.error('Error clearing user device:', e);
            }

            if (cleared > 0) {
                showStatus(
                    `‚úÖ <strong>Device data berhasil dihapus!</strong><br><br>` +
                    `${cleared} item dihapus dari localStorage.<br><br>` +
                    `‚ú® User 17210041060 sekarang bisa login lagi!<br><br>` +
                    `Klik "Open Login Page" untuk coba login.`,
                    'success'
                );
            } else {
                showStatus(
                    `‚ÑπÔ∏è <strong>Tidak ada device data yang perlu dihapus.</strong><br><br>` +
                    `Device registration sudah clear.`,
                    'info'
                );
            }
        }

        function openLoginPage() {
            // Open index.html or login page
            // Adjust this URL to your actual login page
            window.open('index.html', '_blank');
            
            showStatus(
                `üîê <strong>Login page dibuka!</strong><br><br>` +
                `Silakan login dengan:<br>` +
                `‚Ä¢ NIK: <code>17210041060</code><br>` +
                `‚Ä¢ Password: <code>tanjung2025</code><br><br>` +
                `Device registration sudah di-clear, login seharusnya berhasil!`,
                'success'
            );
        }

        // Auto-check on page load
        window.addEventListener('load', function() {
            setTimeout(function() {
                showStatus(
                    `‚ÑπÔ∏è <strong>Tool siap digunakan</strong><br><br>` +
                    `Klik "Check Device Registration" untuk mulai.`,
                    'info'
                );
            }, 500);
        });
    </script>
</body>
</html>
